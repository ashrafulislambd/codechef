{"category_name":"hard","status":"success","problem_code":"QTREE","problem_name":"Queries on tree again!","body":"<span class=\"solution-visible-txt\">All submissions for this problem are available.<\/span><p>\nYou are given a simple connected graph <b>G<\/b> with <b>N<\/b> vertices and <b>N<\/b> edges (a simple graph is an un-directed graph that has no loops and no more than one edge between any two different vertices).<br \/>\nIt is obvious that the graph <b>G<\/b> contains exactly one cycle and you can assume that the length of this cycle is odd (there are odd number of vertices in this cycle).<br \/>\nThe vertices are numbered from 1 to <b>N<\/b>. Each edge is assigned a corresponding integer weight.<br \/>\nYour mission is to stimulate two types of queries :<\/p>\n<ul>\n<li>\nUpdate query represented by <b>f u v<\/b>: change the sign of all the weights of the edges on the shortest path (you can see the definition of shortest path in this problem later on) from vertex <b>u<\/b> to vertex <b>v<\/b>.\n<\/li>\n<li>\nFind query represented by <b>? u v<\/b>: On the shortest path from vertex <b>u<\/b> to vertex <b>v<\/b>, find the (possibly empty) set of consecutive edges such that the sum of the weights is maximal. In other words, let's define the shortest path from <b>u<\/b> to <b>v<\/b> as <b>a_1, a_2, ..., a_k<\/b> (where <b>a_1<\/b> = <b>u<\/b> and <b>a_k<\/b> = <b>v<\/b>). You have to find <b>a_i<\/b> and <b>a_j<\/b> such that <b>i<\/b> &lt;= <b>j<\/b> and the sum of the weights of the edges of the path <b>a_i, a_(i + 1), ..., a_j<\/b> is as large as possible. You just have to find that sum.\n<\/li>\n<\/ul>\n\n<p>\nThe shortest path between two vertices <b>u<\/b> and <b>v<\/b> is the path connecting them with the minimal number of vertices. In this problem, it is obvious that there is only one shortest path between any pair of vertices of <b>G<\/b>.\n<\/p>\n<h3>Input<\/h3>\n<p>The first line contains an integer <b>N<\/b>. Each of the next <b>N<\/b> lines represents an edge of the graph with three integers <b>u v c<\/b> which mean there is an edge connecting vertices <b>u<\/b> and <b>v<\/b> and it is has weight <b>c<\/b>.<br \/>\nThe next line contains an integer <b>Q<\/b>, the number of queries. Each of the next <b>Q<\/b> lines represents a query in one of the two forms above.\n<\/p>\n<h3>Output<\/h3>\n<p>\nFor each <b>find<\/b> query, print the result of the query (the maximal sum) on a line.\n<\/p>\n<h3>Constraints<\/h3>\n<ul>\n<li>1 &le; <b>N<\/b> &le; 100,000<\/li>\n<li>1 &le; <b>u<\/b>, <b>v<\/b> &le; <b>N<\/b><\/li>\n<li>-10,000 &le; <b>c<\/b> &le; 10,000<\/li>\n<li>1 &le; <b>Q<\/b> &le; 100,000<\/li>\n<\/ul>\n<h3>Example<\/h3>\n<pre>\n<b>Input:<\/b>\n6\n1 2 1\n2 3 1\n3 1 1\n2 4 1\n4 5 1\n3 6 1\n3\n? 5 6\nf 2 3\n? 5 6\n\n<b>Output:<\/b>\n4\n2\n<\/pre><h3>Explanation<\/h3>\n<p>The shortest path from 5 to 6 is 5, 4, 2, 3, 6. All the edges on this path have weight 1 so the answer to the first query is 4. After the second query, the weight of the edge (2, 3) is - 1. The edges on the path 5, 4, 2, 3, 6 have weights 1, 1, -1, 1 respectively. so the answer for the third query is 2.<\/p>\n","languages_supported":"ADA, ASM, BASH, BF, C, C99 strict, CAML, CLOJ, CLPS, CPP 4.3.2, CPP 4.9.2, CPP14, CS2, D, ERL, FORT, FS, GO, HASK, ICK, ICON, JAVA, JS, LISP clisp, LISP sbcl, LUA, NEM, NICE, NODEJS, PAS fpc, PAS gpc, PERL, PERL6, PHP, PIKE, PRLG, PYTH, PYTH 3.4, RUBY, SCALA, SCM guile, SCM qobi, ST, TCL, TEXT, WSPC","max_timelimit":"2","source_sizelimit":"50000","problem_author":"tuananh93","problem_author_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #FFBF00;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>5&#9733;<\/span><span>tuananh93<\/span>","problem_tester":"pieguy","problem_tester_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #FF7F00;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>6&#9733;<\/span><span>pieguy<\/span>","date_added":"26-12-2012","tags":"<a class='problem-tag-small ' href='\/tags\/problems\/hard'>\n                    hard\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/heavy-light'>\n                    heavy-light\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/may13'>\n                    may13\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/segment-tree'>\n                    segment-tree\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/simple-math'>\n                    simple-math\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/tuananh93'>\n                    tuananh93\n                <\/a>","editorial_url":"http:\/\/discuss.codechef.com\/problems\/QTREE","user":{"username":null},"time":{"view_start_date":1368440849,"submit_start_date":1368441000,"visible_start_date":1368441000,"end_date":1735669800,"current":1493556808},"todo":false,"problem_status":"unattempted"}