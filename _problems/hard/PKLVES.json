
{"category_name":"hard","status":"success","problem_code":"PKLVES","problem_name":"Chef and Elephant Tree","body":"<span class=\"solution-visible-txt\">All submissions for this problem are available.<\/span>### Read problem statements in [Hindi](http:\/\/www.codechef.com\/download\/translated\/MAY19\/hindi\/PKLVES.pdf), [Bengali](http:\/\/www.codechef.com\/download\/translated\/MAY19\/bengali\/PKLVES.pdf), [Mandarin Chinese](http:\/\/www.codechef.com\/download\/translated\/MAY19\/mandarin\/PKLVES.pdf), [Russian](http:\/\/www.codechef.com\/download\/translated\/MAY19\/russian\/PKLVES.pdf), and [Vietnamese](http:\/\/www.codechef.com\/download\/translated\/MAY19\/vietnamese\/PKLVES.pdf) as well.\n\nLet's define an *elephant tree* with size $N$ as a rooted tree with $N$ vertices (numbered $1$ through $N$) such that:\n- vertex $1$ is the root\n- for any three vertices $u$, $v$ and $w$ such that $u \\lt v \\lt w$, if $w$ is a (direct or indirect) descendant of $u$, then $v$ is also a descendant of $u$\n\nLittle Chef has an elephant tree with size $N$. Today, he wants to use the leaves of this tree to decorate $Q$ dishes (a leaf is a vertex with no children). For each dish, he picks some range $[L, R]$ and he wants to uniformly randomly choose a pair of distinct leaves with labels between $L$ and $R$ inclusive. These leaves are removed and used to decorate the dish; since the tree is magical, the removed leaves grow back immediately.\n\nYou should answer $Q$ queries. In each query, Chef is decorating one dish and wants to know the expected value of the distance between the chosen leaves. It can be proved that if at least one pair of leaves can be chosen, this expected value can be expressed as a fraction $P\/D$, where $P$ and $D$ are coprime positive integers and $D$ is coprime to $998,244,353$.\n\nThe answer to a query is $0$ if there is at most one leaf in the given range (no pair of leaves can be chosen) or $P \\cdot D^{-1}$ modulo $998,244,353$ otherwise, where $D^{-1}$ denotes the multiplicative inverse of $D$ modulo $998,244,353$.\n\nLittle Chef is very unpredictable, so you have to answer each query immediately after he gives it to you.\n\n### Input\n- The first line of the input contains two space-separated integers $N$ and $Q$.\n- The second line contains $N-1$ space-separated integers $f_2, f_3, \\ldots, f_N$. For each valid $i$, $f_i$ denotes the parent of vertex $i$.\n- The following $Q$ lines describe queries. Each of these lines contains two space-separated integers $x$ and $y$. Let's denote the answer to the previous query by $ans$ (if this is the first query, $ans = 0$). Then, the parameters $L$ and $R$ can be computed as $L = x \\oplus ans$ and $R = y \\oplus ans$.\n\n### Output\nFor each query, print a single line containing one integer \u2015 the answer to the query.\n\n### Constraints\n- $2 \\le N, Q \\le 300,000$\n- $i \\gt f_i$ for each valid $i$\n- $1 \\le L \\le R \\le N$\n\n### Subtasks\n**Subtask #1 (10 points):** $2 \\le N, Q \\le 300$\n\n**Subtask #2 (10 points):** $2 \\le N, Q \\le 3,000$\n\n**Subtask #3 (30 points):** the tree is a binary tree\n\n**Subtask #4 (50 points):** original constraints\n\n### Example Input\n```\n10 3\n1 2 2 4 5 5 1 8 1 \n2 10\n598946617 598946610\n598946618 598946609\n```\n\n### Example Output\n```\n598946616\n598946616\n332748122\n```\n\n### Explanation\nThe leaves are vertices $3$, $6$, $7$, $9$ and $10$.\n- In the first query, $L = 2$, $R = 10$ and the expected value is $21\/5$.\n- In the second query, $L = 1$, $R = 10$ and the expected value is $21\/5$ again.\n- In the third query, $L = 2$, $R = 9$ and the expected value is $13\/3$.\n","languages_supported":"C, CPP14, JAVA, PYTH, PYTH 3.6, PYPY, CS2, PAS fpc, PAS gpc, RUBY, PHP, GO, NODEJS, HASK, rust, SCALA, swift, D, PERL, FORT, WSPC, ADA, CAML, ICK, BF, ASM, CLPS, PRLG, ICON, SCM qobi, PIKE, ST, NICE, LUA, BASH, NEM, LISP sbcl, LISP clisp, SCM guile, JS, ERL, TCL, kotlin, PERL6, TEXT, SCM chicken, PYP3, CLOJ, R, COB, FS","max_timelimit":"1","source_sizelimit":"50000","problem_author":"wxs02wxs0103","problem_author_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #FFBF00;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>5&#9733;<\/span><span>wxs02wxs0103<\/span>","problem_tester":null,"problem_tester_html_handle":"","date_added":"25-04-2019","tags":"<a class='problem-tag-small ' href='\/tags\/problems\/wxs02wxs0103'>wxs02wxs0103<\/a>","time":{"view_start_date":1557739980,"submit_start_date":1557739980,"visible_start_date":1557739980,"end_date":1735669800,"current":1559472992},"user":{"username":"","access":"default"},"todo":false,"problem_status":"unattempted","is_direct_submittable":false}